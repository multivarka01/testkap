<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Login</title>
</head>
<body style="background:#06080f;color:white;font-family:Arial;text-align:center;padding-top:100px;">

<h2>Admin Panel</h2>
<button onclick="login()">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ GitHub</button>

<div id="status" style="margin-top:20px;"></div>

<script>
const CLIENT_ID = "Ov23liWB3Ko59BiDS8jy"; // –≤—Å—Ç–∞–≤—å —Å—é–¥–∞

function login(){
  const redirect = window.location.href;
  const url = `https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}&scope=repo&redirect_uri=${redirect}`;
  window.location.href = url;
}

async function checkUser(token){
  const repoOwner = "multivarka01";
  const repoName = "testkap";

  const response = await fetch(
    `https://api.github.com/repos/${repoOwner}/${repoName}/collaborators/${await getUsername(token)}/permission`,
    {
      headers:{
        Authorization:`token ${token}`
      }
    }
  );

  if(response.status === 200){
    document.getElementById("status").innerHTML="–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω üëë";
  } else {
    document.getElementById("status").innerHTML="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω ‚ùå";
  }
}

async function getUsername(token){
  const res = await fetch("https://api.github.com/user",{
    headers:{ Authorization:`token ${token}` }
  });
  const data = await res.json();
  return data.login;
}

const params = new URLSearchParams(window.location.search);
const token = params.get("access_token");

if(token){
  checkUser(token);
}
</script>

</body>
</html>
